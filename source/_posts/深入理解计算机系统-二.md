---
title: 深入理解计算机系统(二)
date: 2020-07-17 00:12:21
tags:
  - 计算机基础
categories: 计算机基础
---

本篇为《深入理解计算机系统》学习笔记的第2篇：整数。

<!-- more -->

网络上找到了该书的第3版，pdf文件，以后的学习会以这个版本的内容为主，夹杂着个人积累的一些知识。

我们很熟悉整数在数学属性上的表示，它是我们从小学甚至幼儿园就已经接触的知识了，但是现在我们把视线转向计算机，看计算机是如何使用位来编码和定义整数的，这将为我们打开一个完全不同的世界。

[第一篇笔记](https://liqinshan.github.io/posts/33669/) 中已经讲过，数据类型的长度（数据大小）受字长影响而有差异。64位系统上，C语言整形数据类型的典型取值范围如下：

<img src="/images/int.jpg" alt="整形数据类型大小">

从图中可以看出，负数的范围比正数的范围大1，这跟它的位编码方式有关，涉及到原码、反码、补码的概念和原理。

### 原码、反码、补码

数学计算中的整数有正数和负数，而计算机里只有二进制的0和1，为了表示正数和负数，计算机使用一个bit的符号位0或1来表示正号（+）或负号（-），符号位放在数值二进制形式的最高位。为了将符号位和数值一起编码，计算机设计了多种编码方式来实现位向量到整数的映射，重要的几个编码方式就是原码、补码、反码。

书中在这部分内容中有大量的原理和公式，我们抛开复杂的原理和公式，对于原码、反码、补码的定义，简单概括说就是：

```c
正数的原码、反码、补码都是它自己
负数的原码是它自己；
负数的反码：符号位不变，其余各位取反
负数的补码：符号位不变，其余各位取反，最后末位加1，即在反码的基础上末位加1

数字    原码         反码         补码
+1     0000 0001    0000 0001    0000 0001
-1     1000 0001    1111 1110    1111 1111 
```

计算机为什么使用这些编码方式来表示有符号整数呢？是为了减少电路设计的复杂度，提高运算的速度，它把符号位也作为数值直接参与运算，但是由于符号位并不是真正的数值，所以才有了这些编码方式，方便转换和运算。

当某些场景需要使用负数值时，对有符号整数使用的最常见编码形式就是补码。有趣的是，C语言并没有要求使用哪种方式来表示有符号整数，但是几乎所有的机器都是这么做的；而在Java语言中，明确要求采用补码来表示整数。

### 有符号数和无符号数之间的转换

书中在这一部分，也涉及到了大量的原理和公式。抛开这些原理和公式，结论是：有符号数到无符号数的隐式强制转换有可能会导致错误或者漏洞，避免这类错误的一种方法是绝不使用无符号数。

实际上，除C语言以外，很少有语言支持无符号数，比如Java只支持有符号数，并且要求以补码运算来实现，移位运算在这个场景中发挥着重要的作用。

对于无符号数而言，仅当被看作是位的集合而没有任何数字意义时，无符号数才是非常有用的，比如往一个数值中放入各种布尔条件的标记（flag）。地址同样如此，也是无符号的。题外话，第一篇笔记讲到的权限系统中位掩码的使用，也是如此。

### 整数运算

两个正数相加会得到一个负数？表达式x < y和x - y < 0会产生不同的结果？这些的确都是有可能的。

待续。。